---
title: "OAuth 2.0 μ•μ•„λ³΄κΈ°"
date: 2022-09-04
draft: false
description: "OAuth 2.0 μ•μ•„λ³΄κΈ°"
tags: ["web","oauth"]
categories: ["security"]
---
<img src=featured.png width=50% alt="thumbnail" style="display: block;margin: auto"/>

[PortSwigger](https://portswigger.net/web-security/oauth/grant-types)μ κΈ€μ„ λ²μ—­ν•μ€μµλ‹λ‹¤ π€

# π“ 01. OAuth 2.0 μ΄λ€?
**OAuth 2.0**("**O**penΒ **Auth**orization 2.0")λ” μΈν„°λ„· μ‚¬μ©μλ“¤μ΄ λΉ„λ°€λ²νΈλ¥Ό μ κ³µν•μ§€ μ•κ³  λ‹¤λ¥Έ μ›Ήμ‚¬μ΄νΈ μƒμ μμ‹ λ“¤μ μ •λ³΄μ— λ€ν•΄ μ›Ήμ‚¬μ΄νΈλ‚ μ• ν”λ¦¬μΌ€μ΄μ…μ μ ‘κ·Ό κ¶ν•μ„ λ¶€μ—¬ν•  μ μλ” κ³µν†µμ μΈ μλ‹¨μΌλ΅μ„ μ‚¬μ©λλ”, μ ‘κ·Ό μ„μ„μ„ μ„ν•Β ν‘μ¤€μ…λ‹λ‹¤.

OAuthλ¥Ό μ΄μ©ν•λ©΄ μ•„λ κ·Έλ¦Όκ³Ό κ°™μ΄ λ„¤μ΄λ²„, μΉ΄μΉ΄μ¤μ¤, νμ΄μ½” λ“± νƒ€ μ„λΉ„μ¤λ¥Ό μ΄μ©ν•μ—¬ λ΅κ·ΈμΈμ„ ν•  μ μμµλ‹λ‹¤. λν• κ°€μ… μ‹μ—λ„ νƒ€ μ„λΉ„μ¤λ¥Ό μ΄μ©ν•μ—¬ μ •λ³΄λ¥Ό μ κ³µν•κ³  κ°€μ…μ„ ν•  μλ„ μμµλ‹λ‹¤.

![oauth example](1.png)


## 01-01. OAuth 2.0 κµ¬μ„± μ”μ†
-   **ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…**Β : μ‚¬μ©μ λ°μ΄ν„°μ— μ•΅μ„Έμ¤ν•λ ¤λ” μ›Ήμ‚¬μ΄νΈ λλ” μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…
  (κ°€μ…ν•λ ¤λ” μ‚¬μ΄νΈ)
-   **λ¦¬μ†μ¤ μ¤λ„**Β : ν΄λΌμ΄μ–ΈνΈ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ•΅μ„Έμ¤ν•λ ¤λ” λ°μ΄ν„°μ μ‚¬μ©μ
  (μ‚¬μ©μ)
-   **OAuth μ„λΉ„μ¤ μ κ³µμ**Β : μ‚¬μ©μ λ°μ΄ν„° λ° μ•΅μ„Έμ¤λ¥Ό μ μ–΄ν•λ” μ›Ήμ‚¬μ΄νΈ λλ” μ• ν”λ¦¬μΌ€μ΄μ…. μΈμ¦ μ„λ²„ λ° λ¦¬μ†μ¤ μ„λ²„λ΅ μ΄λ£¨μ–΄μ Έ μμΌλ©°, μ΄ λ‘κ³Ό μƒνΈ μ‘μ©ν•κΈ° μ„ν• APIλ¥Ό μ κ³µν•μ—¬ OAuthλ¥Ό μ§€μ›ν•©λ‹λ‹¤.
  (κµ¬κΈ€, μΉ΄μΉ΄μ¤ν†΅, νμ΄μ¤λ¶ λ“±)

## 01-02. OAuth κ¶ν• λ¶€μ—¬ λ°©λ²•
OAuthλ¥Ό μ΄μ©ν•μ—¬ μ •λ³΄ μ”μ²­ μ‹μ—λ” κΈ°λ³Έμ μΌλ΅ μ•„λμ™€ κ°™μ€ κ³Όμ •μ„ κ±°μΉκ² λ©λ‹λ‹¤.

1. **ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…**μ΄ **OAuth μ„λΉ„μ¤ μ κ³µμ**μ—κ² ν•„μ”ν• μ •λ³΄ λ° κ°μΆ… νλΌλ―Έν„°λ¥Ό μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤.

2. **OAuth μ„λΉ„μ¤ μ κ³µμ**λ” **λ¦¬μ†μ¤ μ¤λ„**μ—κ² λ΅κ·ΈμΈκ³Ό κ¶ν•/μ •λ³΄ μ κ³µ λ™μ μ”μ²­μ„ ν•©λ‹λ‹¤.

3. **λ¦¬μ†μ¤ μ¤λ„**κ°€ λ™μ μ‹ **OAuth μ„λΉ„μ¤ μ κ³µμ**μ**λ” **ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…**μ—κ² μΈμ¦ μ½”λ“ λλ” ν† ν°μ„ λ¶€μ—¬ν•μ—¬ μ΄ν›„μ— μ •λ³΄ μ”μ²­ λ° κ²€μ¦μ— μ‚¬μ©λκ² λ©λ‹λ‹¤.

4. μΈμ¦ μ½”λ“μ κ²½μ°, **ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…**κ³Ό **OAuth μ„λΉ„μ¤ μ κ³µμ** κ°„ μ„λ²„ λ€ μ„λ²„ ν†µμ‹ μΌλ΅ ν† ν° λ¶€μ—¬ κ³Όμ •μ„ κ±°μΉκ²λ©λ‹λ‹¤.

5. μ΄ν›„μ—λ” **ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…**μ΄ **OAuth μ„λΉ„μ¤ μ κ³µμ**μ—κ² APIλ¥Ό ν†µν•΄ μ •λ³΄λ¥Ό μ”μ²­ν•κ³  λ°›μ„ μ μκ²λ©λ‹λ‹¤.

μ„μ™€ κ°™μ€ κ³Όμ •μ„ κ±°μΉλ” OAuthμ—λ” 2κ°€μ§€ κ¶ν• λ¶€μ—¬ λ°©λ²•μ΄ μ΅΄μ¬ν•©λ‹λ‹¤. 

### **π« μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹**
![μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹](2.png)


**β‘  μΉμΈ μ”μ²­** : ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ΄ νΉμ • μ‚¬μ©μ λ°μ΄ν„°μ— μ ‘κ·Όν•  μ μλ” κ¶ν•μ„ `/authorization` κ³Ό κ°™μ€ μ—”λ“ ν¬μΈνΈλ΅ μ”μ²­ν•©λ‹λ‹¤. λ³΄ν†µ μ”μ²­ URLμ€ μ•„λμ™€ κ°™μ€ ν•μ‹μ„ κ°€μ§‘λ‹λ‹¤.
```
GET /authorization?client_id=12345&redirect_uri=https://client-app.com/callback&response_type=code&scope=openid%20profile&state=ae13d489bd00e3c24 HTTP/1.1 Host: oauth-authorization-server.com
```
κ° νλΌλ―Έν„°μ μ©λ„λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.
- **client_id** : ν΄λΌμ΄μ–ΈνΈ μ‘μ© ν”„λ΅κ·Έλ¨μ κ³ μ  μ‹λ³„μλ¥Ό ν¬ν•¨ν•λ” ν•„μ λ§¤κ° λ³€μμ…λ‹λ‹¤. μ΄ κ°’μ€ ν΄λΌμ΄μ–ΈνΈ μ‘μ© ν”„λ΅κ·Έλ¨μ΄ OAuth μ„λΉ„μ¤μ— λ“±λ΅ν•  λ• μƒμ„±λ©λ‹λ‹¤.
- **redirect_uri** : κ¶ν• λ¶€μ—¬ μ½”λ“λ¥Ό ν΄λΌμ΄μ–ΈνΈ μ‘μ© ν”„λ΅κ·Έλ¨μΌλ΅ λ³΄λ‚Ό λ• μ‚¬μ©μμ λΈλΌμ°μ €λ¥Ό λ¦¬λ””λ ‰μ…ν•΄μ•Ό ν•λ” URIμ…λ‹λ‹¤. λ§μ€ OAuth κ³µκ²©μ€ μ΄ λ§¤κ° λ³€μ μ ν¨μ„± κ²€μ‚¬μ ν—›μ μ„ μ΄μ©ν•©λ‹λ‹¤.
- **response_type** : κ¶ν• λ¶€μ—¬ λ°©λ²•μ„ μ •ν•©λ‹λ‹¤. μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹μ€ `code`  κ°’μ„ λ¶€μ—¬ν•©λ‹λ‹¤.
- **scope** : μ”μ²­ κ¶ν•μ λ²”μ„λ¥Ό μ •ν•©λ‹λ‹¤. OpenIDμ™€ κ°™μ€ ν‘μ¤€ν™”λ λ²”μ„λ¥Ό μ“°κΈ°λ„ ν•©λ‹λ‹¤.
- **state** : CSRF λ°©μ§€ ν† ν°κ³Ό κ°™μ΄ μ‚¬μ©ν•μ—¬ μ”μ²­μ΄ λ™μΌν• μ‚¬μ©μλ΅λ¶€ν„° μ¨ κ²ƒμΈμ§€ κ³ μ ν• κ°’μ„ μ΄μ©ν•΄ κ²€μ¦ν•©λ‹λ‹¤.

**β‘΅ μ‚¬μ©μ λ΅κ·ΈμΈ λ° λ™μ** :  μ‚¬μ©μλ¥Ό μΈμ¦ν•κΈ° μ„ν•΄ λ΅κ·ΈμΈμ„ μ”μ²­ν•κ³  μ”μ²­ν•λ” κ¶ν•κ³Ό μ •λ³΄μ— λ€ν•΄ λ™μλ¥Ό μ”μ²­ν•©λ‹λ‹¤.

**β‘Ά μΉμΈ μ½”λ“ λ¶€μ—¬** : μ‚¬μ©μκ°€ λ™μν•λ©΄ OAuth μ„λΉ„μ¤ μ κ³µμλ” μ‚¬μ©μμ λΈλΌμ°μ €λ¥Ό κ¶ν• λ¶€μ—¬ μ”μ²­μ `redirect_uri` μ— μ§€μ •λ μ—”λ“ν¬μΈνΈλ΅ λ¦¬λ””λ ‰μ… μ‹ν‚µλ‹λ‹¤. μ”μ²­ URLμ—λ” μΉμΈ μ½”λ“κ°€ λ§¤κ° λ³€μλ΅ ν¬ν•¨λλ©° κµ¬μ„±μ— λ”°λΌ μΉμΈ μ”μ²­κ³Ό λ™μΌν• κ°’μ state λ§¤κ° λ³€μλ¥Ό λ³΄λ‚Ό μλ„ μμµλ‹λ‹¤.
```
GET /callback?code=a1b2c3d4e5f6g7h8&state=ae13d489bd00e3c24 HTTP/1.1
Host: client-app.com
```

**β‘£ μ—‘μ„Έμ¤ ν† ν° μ”μ²­** : ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ΄ μΉμΈ μ½”λ“λ¥Ό λ°›μΌλ©΄ μ•΅μ„Έμ¤ ν† ν°μΌλ΅ κµν™ν•©λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ OAuth μ„λΉ„μ¤μ `/token`  μ—”λ“ν¬μΈνΈμ— μ„λ²„ λ€ μ„λ²„ POST μ”μ²­μ„ λ³΄λƒ…λ‹λ‹¤. μ„λ²„ λ€ μ„λ²„ μ”μ²­μ€ μ™Έλ¶€μ—μ„λ” λ³΄κ±°λ‚ λ³€μ΅°ν•  μ μ—†μµλ‹λ‹¤.
```
POST /token HTTP/1.1 Host: oauth-authorization-server.com
β€¦
client_id=12345&client_secret=SECRET&redirect_uri=https://client-app.com/callback&grant_type=authorization_code&code=a1b2c3d4e5f6g7h8
```
κ° νλΌλ―Έν„°μ λ‚΄μ©μ€ μ•„λμ™€ κ°™μµλ‹λ‹¤.
- **client_secret** : ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ΄ OAuth μ„λΉ„μ¤μ— λ“±λ΅ν•  λ• ν• λ‹Ήλ λΉ„λ°€ν‚¤
- **grant_type** : "/token" μ—”λ“ν¬μΈνΈμ— κ¶ν• λ¶€μ—¬ μ ν•μ„ μ•λ¦½λ‹λ‹¤. μ—¬κΈ°μ„λ” "authorization_code"λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

**β‘¤ μ—‘μ„Έμ¤ ν† ν° λ¶€μ—¬** : ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ΄ μ ν¨ν•λ‹¤λ©΄, μ„λ²„μ—μ„ μ•„λμ™€ κ°™μ΄ ν† ν°μ„ λ¶€μ—¬λ°›μµλ‹λ‹¤.
```
{
	"access_token": "z0y9x8w7v6u5", 
	"token_type": "Bearer", 
	"expires_in": 3600,
	"scope": "openid profile",
	β€¦ 
}
```

**β‘¥ API μ”μ²­ (μ •λ³΄ μ”μ²­)** : ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ€ `Authorization: Bearer` ν—¤λ”μ— μ—‘μ„Έμ¤ ν† ν°μ„ λ‹΄μ•„ `/userinfo`  μ—”λ“ν¬μΈνΈμ— μ‚¬μ©μ μ •λ³΄λ¥Ό μ”μ²­ν•©λ‹λ‹¤. μ΄λ•μ μ—”λ“ν¬μΈνΈλ” μ–΄ν”λ¦¬μΌ€μ΄μ…μ— λ”°λΌ λ‹¤λ¥Ό μ μμµλ‹λ‹¤.
```
GET /userinfo HTTP/1.1 
Host: oauth-resource-server.com 
Authorization: Bearer z0y9x8w7v6u5
```

**β‘¦ μ •λ³΄ μ „μ†΅** : μ‚¬μ©μμ μ •λ³΄λ¥Ό κ°€μ§„ λ¦¬μ†μ¤ μ„λ²„λ” λ°›μ€ ν† ν°μ΄ μ ν¨ν•λ©΄ μ”μ²­λ°›μ€ μ •λ³΄λ¥Ό ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μΌλ΅ μ „μ†΅ν•©λ‹λ‹¤.
```
{ 
	"username":"carlos", 
	"email":"carlos@carlos-montoya.net",
	β€¦ 
}
```

### **π« μ•”μ‹μ  λ¶€μ—¬ λ°©μ‹**
![μ•”μ‹μ  λ¶€μ—¬ λ°©μ‹](3.png)

**β‘  μΉμΈ μ”μ²­** : ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ΄ νΉμ • μ‚¬μ©μ λ°μ΄ν„°μ— μ ‘κ·Όν•  μ μλ” κ¶ν•μ„ `/authorization` κ³Ό κ°™μ€ μ—”λ“ ν¬μΈνΈλ΅ μ”μ²­ν•©λ‹λ‹¤. λ³΄ν†µ μ”μ²­ URLμ€ μ•„λμ™€ κ°™μ€ ν•μ‹μ„ κ°€μ§‘λ‹λ‹¤.
```
GET /authorization?client_id=12345&redirect_uri=https://client-app.com/callback&response_type=token&scope=openid%20profile&state=ae13d489bd00e3c24 HTTP/1.1 Host: oauth-authorization-server.com
```
κ° νλΌλ―Έν„°μ μλ―Έλ” μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹κ³Ό λ™μΌν•λ©° μ•”μ‹μ  λ¶€μ—¬ λ°©μ‹μ—μ„λ” response_typeμ„ `token` μ„¤μ •ν•©λ‹λ‹¤.

**β‘΅ μ‚¬μ©μ λ΅κ·ΈμΈ λ° λ™μ** :  μ‚¬μ©μλ¥Ό μΈμ¦ν•κΈ° μ„ν•΄ λ΅κ·ΈμΈμ„ μ”μ²­ν•κ³  μ”μ²­ν•λ” κ¶ν•κ³Ό μ •λ³΄μ— λ€ν•΄ λ™μλ¥Ό μ”μ²­ν•©λ‹λ‹¤.

**β‘Ά μ•΅μ„Έμ¤ ν† ν° λ¶€μ—¬** : μ‚¬μ©μκ°€ λ™μν•λ©΄ OAuth μ„λΉ„μ¤ μ κ³µμλ” μ‚¬μ©μμ λΈλΌμ°μ €λ¥Ό κ¶ν• λ¶€μ—¬ μ”μ²­μ `redirect_uri` μ— μ§€μ •λ μ—”λ“ν¬μΈνΈλ΅ λ¦¬λ””λ ‰μ…μ‹ν‚µλ‹λ‹¤. μ”μ²­ URLμ—λ” μ•΅μ„Έμ¤ ν† ν°μ΄ URL μ΅°κ° ν•μ‹μΌλ΅ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤. μ•΅μ„Έμ¤ ν† ν°μ€ URL μ΅°κ°μΌλ΅ μ „μ†΅λλ―€λ΅ ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ… μΈ΅μ—μ„λ” μ• μ μ—†μΌλ©° μ‚¬μ©μλ” JavaScript λ“± μ„ μ΄μ©ν•μ—¬ λΈλΌμ°μ € μΈ΅μ—μ„ μ—‘μ„Έμ¤ ν† ν°μ„ νμ‹±ν•μ—¬ μ‚¬μ©ν•΄μ•Ό ν•©λ‹λ‹¤.
μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹κ³Όλ” λ‹¬λ¦¬ μ„λ²„ λ€ μ„λ²„ ν†µμ‹ μ΄ μ•„λ‹λ―€λ΅ μ•΅μ„Έμ¤ ν† ν°μ΄ μ‚¬μ©μ λΈλΌμ°μ €μ— λ…Έμ¶λ©λ‹λ‹¤.
```
GET /callback#access_token=z0y9x8w7v6u5&token_type=Bearer&expires_in=5000&scope=openid%20profile&state=ae13d489bd00e3c24 HTTP/1.1 
Host: client-app.com
```

**β‘£ API μ”μ²­ (μ •λ³΄ μ”μ²­)** : μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹κ³Ό λ™μΌν• ν¨ν‚·μΌλ΅ μ”μ²­μ„ ν•λ‚, μ‚¬μ©μ λΈλΌμ°μ € μΈ΅μ—μ„λ„ μ”μ²­μ΄ λ°μƒν•  μ μμµλ‹λ‹¤.
```
GET /userinfo HTTP/1.1 
Host: oauth-resource-server.com 
Authorization: Bearer z0y9x8w7v6u5
```

**β‘¤ μ •λ³΄ μ „μ†΅** : μ‚¬μ©μμ μ •λ³΄λ¥Ό κ°€μ§„ λ¦¬μ†μ¤ μ„λ²„λ” λ°›μ€ ν† ν°μ΄ μ ν¨ν•λ©΄ μ”μ²­λ°›μ€ μ •λ³΄λ¥Ό ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μΌλ΅ μ „μ†΅ν•©λ‹λ‹¤. μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹κ³Ό λ™μΌν•©λ‹λ‹¤.

# π“ 02. References
\[1\] [PortSwigger - OAuth grant types](https://portswigger.net/web-security/oauth/grant-types)

