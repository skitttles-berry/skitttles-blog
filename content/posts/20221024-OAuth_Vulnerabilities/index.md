---
title: "OAuth μ·¨μ•½μ  μ•μ•„λ³΄κΈ°"
date: 2022-10-24
draft: false
description: "OAuth μ·¨μ•½μ  μ•μ•„λ³΄κΈ°"
tags: ["web","oauth"]
categories: ["security"]
---


<img src=featured.png width=50% alt="thumbnail" style="display: block;margin: auto"/>


PortSwiggerμ OAuth 2.0 authentication vulnerabilitiesλ¥Ό λ²μ—­/μ •λ¦¬ν•μ€μµλ‹λ‹¤ π
[OAuth 2.0 authentication vulnerabilities]([https://portswigger.net/web-security/oauth](https://portswigger.net/web-security/oauth))

[μ§€λ‚ κΈ€ \(OAuth 2.0 μ•μ•„λ³΄κΈ°\)]({{< ref "posts/20220904-oauth_concept/index.md" >}})μ„ ν†µν•΄μ„ OAuthμ— λ€ν•΄μ„ μ•μ•„λ³΄μ•μµλ‹λ‹¤. μ΄λ² κΈ€μ—μ„λ” OAuthμ μ·¨μ•½μ μ„ μ‚΄ν΄λ³΄κ³ μ ν•©λ‹λ‹¤.

> OAuthκ°€ μ‚¬μ©λλ” κ²ƒμ΄ μ‹λ³„λλ©΄ μ•„λ νμ΄μ§€μ— μ ‘μ†ν•μ—¬ μ£Όμ” μ •λ³΄κ°€ μ¶λ ¥λλ”μ§€ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤.
- /.well-known/oauth-authorization-server
- /.well-known/openid-configuration
> 

# π“ 00. μ·¨μ•½μ  λ¶„λ¥

OAuthμ—μ„ λ°μƒν•  μ μλ” μ·¨μ•½μ μΌλ΅λ” μ•„λμ™€ κ°™μ΄ ν¬κ² 5κ°€μ§€ μ •λ„κ°€ μμµλ‹λ‹¤.

- ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ μ·¨μ•½μ 
    - π’¥ **μ•”μ‹μ  λ¶€μ—¬ μ ν• μ·¨μ•½μ **
        - OAuth μ•”μ‹μ  νλ¦„μ„ ν†µν• μΈμ¦ μ°ν
    - π’¥ **λ―Έν΅ν• CSRF λ³΄νΈ**
        - κ°•μ  OAuth ν”„λ΅ν•„ μ—°κ²°
- OAuth μ„λΉ„μ¤μ μ·¨μ•½μ 
    - π’¥ **μΈμ¦ μ½”λ“ λ° μ•΅μ„Έμ¤ ν† ν° λ„μ¶**
        - redirect_uriλ¥Ό ν†µν• OAuth κ³„μ • λ„μ©
        - redirect_uri κ²€μ¦ λ―Έν΅
        - ν”„λ΅μ‹ νμ΄μ§€λ¥Ό ν†µν•΄ OAuth μ•΅μ„Έμ¤ ν† ν° ν›”μΉκΈ°
    - π’¥ **λ―Έν΅ν• λ²”μ„ μ ν¨μ„± κ²€μ‚¬**
    - π’¥ **ν™•μΈλμ§€ μ•μ€ μ‚¬μ©μ λ“±λ΅**

# π“ 01. μ•”μ‹μ  λ¶€μ—¬ μ ν•

μ•”μ‹μ  λ¶€μ—¬ μ ν•μΌλ΅ OAuth κµ¬ν„ μ‹ μ…λ ¥ κ°’ κ²€μ¦ λ° μΈμ¦μ΄ λ―Έν΅ν•μ—¬ λ°μƒν•©λ‹λ‹¤.

μ•”μ‹μ  λ¶€μ—¬ μ ν•μ€ λ³΄ν†µ λ‹¨μΌ νμ΄μ§€μ—μ„ μ‚¬μ©λλ‚ νΈλ¦¬ν•λ‹¤λ” μ΄μ μΌλ΅ μΈν•΄ μ„λ²„-ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ—μ„ μ‚¬μ©λκΈ°λ„ ν•©λ‹λ‹¤. 

μ΄λ• μΈμ¦ μ„Έμ…μ„ μ μ§€ν•κΈ° μ„ν•΄ μ‚¬μ©μ μ •λ³΄λ¥Ό μ„λ²„λ΅ λ³΄λ‚΄μ–΄ μΏ ν‚¤(μ„Έμ…)μ„ λ°›κ² λλ”λ°, μ „μ†΅λλ” μ‚¬μ©μ μ •λ³΄λ¥Ό λ³€μ΅°ν•μ—¬ νƒ€ μ‚¬μ©μλ΅ λ΅κ·ΈμΈμ„ μ‹λ„ν•΄λ³Ό μ μμµλ‹λ‹¤.

### π”’ λ€μ‘λ°©μ•

μ—¬λ¬ νμ΄μ§€λ¥Ό κ°€μ§€λ” ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ μ–΄ν”λ¦¬μΌ€μ΄μ…μ—μ„λ” κ°€κΈ‰μ  **μΉμΈμ½”λ“ λ¶€μ—¬ λ°©μ‹**μΌλ΅ OAuthλ¥Ό κµ¬ν„ν•΄μ•Ό ν•λ©° μ‚¬μ©μμ μ…λ ¥ κ°’μ„ κ²€μ¦ν•μ—¬ λ¶€μ μ ν• μΈμ¦ κ΄€λ ¨ μ •λ³΄λ¥Ό ν•„ν„°λ§ν•΄μ•Ό ν•©λ‹λ‹¤.

# π“ 02. λ―Έν΅ν• CSRF λ³΄νΈ

ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ—μ„ CSRF λ³΄νΈκ°€ λ―Έν΅ν• κ²½μ°, CSRF μ·¨μ•½μ μ„ μ΄μ©ν•΄ μ‚¬μ©μμ—κ² κ³µκ²©μμ ν”„λ΅ν•„μ„ κ°•μ λ΅ μ—°κ²°μ‹ν‚¬ μ μμµλ‹λ‹¤.

**/oauth-linking?code=[...]** μ™€ κ°™μ€ νμ΄μ§€μ— μ‚¬μ©μκ°€ κ°•μ λ΅ μ ‘μ†ν•λ„λ΅ ν•λ©΄ κ³µκ²©μμ μ†μ… ν”„λ΅ν•„μ΄ μ‚¬μ©μμ κ³„μ •μ— κ°•μ λ΅ μ—°κ²°λ  μ μμµλ‹λ‹¤.

### π”’ λ€μ‘λ°©μ•

CSRF ν† ν°κ³Ό κ°™μ€ μ—­ν• μ„ ν•λ” `state` νλΌλ―Έν„°λ¥Ό μ΄μ©ν•μ—¬ CSRF μ·¨μ•½μ μ— λ€μ‘ν•©λ‹λ‹¤. λν•, OAuthλ§μ„ μ΄μ©ν•μ—¬ λ΅κ·ΈμΈν•λ„λ΅ κµ¬ν„ν•  κ²½μ°μ—λ„ ν•΄λ‹Ή μ·¨μ•½μ μ— λ€μ‘ν•  μ μμµλ‹λ‹¤.

# π“ 03. μΈμ¦ μ½”λ“ λ° μ•΅μ„Έμ¤ ν† ν° λ„μ¶

## 03-01. redirect_uriλ¥Ό ν†µν• OAuth κ³„μ • λ„μ©

μΈμ¦ μ ν•μ— λ”°λΌ μΉμΈ μ½”λ“ λλ” ν† ν°μ„ νƒμ·¨ν•  μ μλ” μ·¨μ•½μ μ…λ‹λ‹¤. 

/auth νμ΄μ§€ μ”μ²­ μ‹ `redirect_uri` νλΌλ―Έν„°λ¥Ό ν•¨κ» λ³΄λ‚΄λ©°, μ‚¬μ©μλ” μΉμΈμ½”λ“ λλ” ν† ν°κ³Ό ν•¨κ» redirect_uriλ΅ λ¦¬λ‹¤μ΄λ ‰μ… λ©λ‹λ‹¤.

μ΄λ¥Ό μ΄μ©ν•μ—¬ κ³µκ²©μλ” `redirect_uri`λ¥Ό κ³µκ²©μ μ„λ²„ μ£Όμ†λ΅ λ³€κ²½ν•μ—¬ μ‚¬μ©μκ°€ μΉμΈμ½”λ“ λλ” ν† ν°κ³Ό ν•¨κ» λ³€μ΅°λ `redirect_uri`μ— λ¦¬λ‹¤μ΄λ ‰μ… λλ„λ΅ λ§λ“¤ μ μμµλ‹λ‹¤.

κ³µκ²© μ μ°¨λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.

1. `redirect_uri`κ°€ ν¬ν•¨λ /auth νμ΄μ§€ μ ‘μ† μ”μ²­μ„ Intercept ν•μ—¬ `redirect_uri` νλΌλ―Έν„°κ°€ λ³€μ΅° κ°€λ¥ν•μ§€ ν…μ¤νΈν•©λ‹λ‹¤. (Repeaterλ΅ λ³€μ΅° κ°’ μ „μ†΅ λ“±)
2. `redirect_uri`λ¥Ό κ³µκ²©μ μ„λ²„ μ£Όμ†λ΅ λ³€μ΅°ν•μ—¬ μ‚¬μ©μκ°€ μΉμΈ μ½”λ“ λλ” ν† ν°κ³Ό ν•¨κ» κ³µκ²©μ μ„λ²„λ΅ λ¦¬λ‹¤μ΄λ ‰μ… λλ„λ΅ λ§λ“­λ‹λ‹¤.
3. λ³€μ΅°λ /auth URLμ„ λ°°ν¬ν•μ—¬ κ³µκ²©μ μ„λ²„μ— κΈ°λ΅λ μΉμΈ μ½”λ“ λλ” ν† ν°μ„ ν™•μΈν•©λ‹λ‹¤.
4. κ³µκ²©μλ” /oauth-callback URLμ— μΉμΈ μ½”λ“ λλ” ν† ν°μ„ νλΌλ―Έν„°λ΅ ν¬ν•¨μ‹μΌ μ ‘μ†, μ‚¬μ©μ κ³„μ •μ— λ¬΄λ‹¨ μ ‘μ†ν•  μ μμµλ‹λ‹¤.

## 03-02. redirect_uri κ²€μ¦ λ―Έν΅

μΈμ¦ μ„λ²„ μΈ΅μ—μ„ `redirect_uri` κ²€μ¦μ΄ λ―Έν΅ν•  κ²½μ° μ•„λμ™€ κ°™μ€ μ°ν ν¨ν„΄μ΄ μ ν¨ν•  μ μμµλ‹λ‹¤.

- URI κµ¬λ¬Έ λ¶„μ„μ„ μ΄μ©ν•μ—¬ ν—μ©λ λ¬Έμμ—΄λ΅ μ‹μ‘ν•μ—¬ κ³µκ²©μ μ„λ²„ μ£Όμ† μ‚½μ…
    - [https://default-host.com](https://default-host.com/) [&@foo.evil-user.net](mailto:&@foo.evil-user.net)#@bar.evil-user.net/
- μ¤‘λ³µλ `redirect_uri` νλΌλ―Έν„°λ¥Ό ν¬ν•¨
    - [https://oauth-authorization-server.com/?client_id=123&redirect_uri=client-app.com/callback&redirect_uri=evil-user.net](https://oauth-authorization-server.com/?client_id=123&redirect_uri=client-app.com/callback&redirect_uri=evil-user.net)
- [localhost](http://localhost) μ™€ κ°™μ΄ κ°λ° μ‹μ— μ΄μ©λ  μ μλ” λ„λ©”μΈ μ‚¬μ©
    - localhost.evil-user.net
- response_mode λ“± νλΌλ―Έν„°λ¥Ό μΌλ¶€ λ³€κ²½ν•μ—¬ νλΌλ―Έν„° νμ‹± λ°©μ‹μ΄ λ³€κ²½λλ”μ§€ ν™•μΈ

## 03-03. ν”„λ΅μ‹ νμ΄μ§€λ¥Ό ν†µν•΄ OAuth μ•΅μ„Έμ¤ ν† ν° ν›”μΉκΈ°

λ‹¤μκ³Ό κ°™μ€ ν¨ν„΄μ„ μ΄μ©ν•μ—¬ `redirect_uri` κ²€μ¦μ„ μ°νν•  μ μμµλ‹λ‹¤.

- μƒμ„ λ””λ ‰ν† λ¦¬ νƒμƒ‰ λ¬Έμ (`..`) μ΄μ©
    - [https://client-app.com/oauth/callback/../../example/path](https://client-app.com/example/path)
    - μ„ uriλ” [https://client-app.com/example/path](https://client-app.com/example/path) λ΅ μΈμ‹λ©λ‹λ‹¤.

μ°ν URIλ¥Ό μ°Ύμ•μΌλ©΄, ν•΄λ‹Ή νμ΄μ§€μ—μ„ μ¶”κ°€μ μΈ μ·¨μ•½μ μ΄ λ‚μ¤λ”μ§€ ν™•μΈν•μ—¬ μ•…μ©ν•΄μ•Ό ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄ Open Redirect, XSS λ“±μ΄ μμµλ‹λ‹¤.

### π”’ λ€μ‘λ°©μ•

- state, nonce μ™€ κ°™μ€ νλΌλ―Έν„°λ” μ™„λ²½ν• λ€μ‘μ±…μ΄ λμ§€ λ»ν•©λ‹λ‹¤.
ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μΌλ΅ μΉμΈμ½”λ“ μ „μ†΅ μ‹μ— μΈμ¦μ„λ²„ μΈ΅μ—μ„ `redirect_uri`κ°€ μ ν¨ν•μ§€ κ²€μ¦ν•΄μ•Ό ν•©λ‹λ‹¤. κ°€λ¥ν•λ‹¤λ©΄ ν™”μ΄νΈλ¦¬μ¤νΈλ΅ κ²€μ¦ν•  κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤.
ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…κ³Ό μΈμ¦ μ„λ²„ μ‚¬μ΄μ μ μ°¨μ΄λ―€λ΅ λΈλΌμ°μ € μΈ΅μΈ μ‚¬μ©μ(κ³µκ²©μ)λ” κ°μ…(λ³€μ΅°)ν•  μ μ—†μ–΄ κ²€μ¦ μμ²΄κ°€ λ³€μ΅°λ  μ„ν—μ΄ μ μµλ‹λ‹¤.
- νΉμλ¬Έμ λ“± μ„ν ν¨ν„΄μ„ λ°μƒ μ‹ν‚¬ μ μλ” λ¬Έμλ¥Ό ν•„ν„°λ§ν•©λ‹λ‹¤.
- μƒμ„Έν• `redirect_uri` ν•„ν„°λ§, Open Redirect, XSS, HTML injection λ“±μ μ·¨μ•½μ λ„ μ΅°μΉλ¥Ό ν•΄μ•Όν•©λ‹λ‹¤.

# π“ 04. **λ―Έν΅ν• κ¶ν• λ²”μ„ μ ν¨μ„± κ²€μ‚¬**

## 04-01. μΉμΈ μ½”λ“ λ¶€μ—¬ λ°©μ‹

μ•…μ„± ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μ„ μΈμ¦ μ„λ²„μ— λ“±λ΅ν•μ—¬ μ‚¬μ©μμ μΉμΈ μ½”λ“λ¥Ό νƒμ·¨ν•  μ μμΌλ©° νλ“ν• μ½”λ“λ¥Ό μ΄μ©ν•΄ μƒλ΅μ΄ κ¶ν• λ²”μ„ νλΌλ―Έν„°λ¥Ό μ„¤μ •ν•μ—¬ ν† ν°μ„ μ”μ²­ν•  μ μμµλ‹λ‹¤.

μ΄κΈ° κ¶ν• λ²”μ„μ™€ μ΄ν›„ μ”μ²­ κ¶ν• λ²”μ„μ— λ€ν•΄ κ²€μ¦μ΄ λ―Έν΅ν• κ²½μ°, κ³µκ²©μκ°€ μ”μ²­ν• κ¶ν• λ²”μ„μ ν† ν°μ΄ μ•…μ„± ν΄λΌμ΄μ–ΈνΈ μ–΄ν”λ¦¬μΌ€μ΄μ…μΌλ΅ μ „μ†΅λ©λ‹λ‹¤.

## 04-02. μ•”μ‹μ  λ¶€μ—¬ λ°©μ‹

μ•΅μ„Έμ¤ ν† ν°μ΄ μ‚¬μ©μ λΈλΌμ°μ €λ¥Ό ν†µν•΄ μ „μ†΅λλ―€λ΅ κ³µκ²©μκ°€ ν† ν°μ„ νƒμ·¨ν•μ—¬ μ§μ ‘ μ‚¬μ© κ°€λ¥ν•©λ‹λ‹¤.

νƒμ·¨ν• μ•΅μ„Έμ¤ ν† ν°μ„ μ΄μ©ν•΄ /userinfo λ“±μ— μ”μ²­μ„ λ³΄λ‚΄λ©° μƒ λ²”μ„ νλΌλ―Έν„°λ¥Ό μ„¤μ •ν•λ©΄ μƒ κ¶ν• λ²”μ„μ μ •λ³΄κ°€ μ „μ†΅λ©λ‹λ‹¤.

### π”’ λ€μ‘λ°©μ•

μΈμ¦ μ„λ²„μ—μ„λ” κ¶ν• λ²”μ„ μ”μ²­μ΄ μ¤λ©΄, ν•΄λ‹Ή μ–΄ν”λ¦¬μΌ€μ΄μ…μ΄λ‚ μ‚¬μ©μμ—κ² μ ν¨(μ λ‹Ή)ν• κ¶ν•μΈμ§€ κ²€μ¦ν•΄μ•Ό ν•©λ‹λ‹¤.

# π“ **05. ν™•μΈλμ§€ μ•μ€ μ‚¬μ©μ λ“±λ΅**

λ‡λ‡ OAuth μ„λΉ„μ¤ μ κ³µμλ” κ°€μ…μμ μƒμ„Έν• μ •λ³΄λ¥Ό ν™•μΈν•μ§€ μ•μ•„ μ•…μμ μΈ μ‚¬μ©μκ°€ ν”Όν•΄ μ‚¬μ©μμ μ •λ³΄λ¥Ό μ΄μ©ν•΄ κ³„μ •μ„ μƒμ„±ν•  μ μμΌλ©°, μƒμ„±λ κ³„μ •μ„ μ΄μ©ν•΄ μΈμ¦ μ”μ²­μ„ μ‹λ„ν•  μ μμµλ‹λ‹¤.

### π”’ λ€μ‘λ°©μ•

κΈ°μ΅΄ κ³„μ •μ— νƒ€ OAuth μ„λΉ„μ¤ κ³„μ •μ„ μ—°λ™μ‹ν‚¬ λ•μ—λ” κΈ°μ΅΄ κ³„μ •μ—μ„ λ³ΈμΈμΈμ¦ λ“±μ„ μν–‰ν•μ—¬ μ‚¬μΉ­ κ³„μ •μ΄ μ–΄ν”λ¦¬μΌ€μ΄μ… κ³„μ •μ— λ¬΄λ‹¨ μ—°λ™λλ” κ²ƒμ„ λ§‰μ•„μ•Όν•©λ‹λ‹¤.

# π“– References
\[1\] [OAuth 2.0 authentication vulnerabilities](https://portswigger.net/web-security/oauth)